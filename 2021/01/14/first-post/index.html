<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="# 建模流程Check list明确建模目标数据探索 现状分析  了解各个环节的转化情况，目的有两个 &gt;  一方面可以找到转化薄弱的环节，做为建模的着手点；另一方面可以做为模型效果对标的baseline  当前在使用的方案是什么？效果如何？ &gt;  当前在使用的方案大多是业务经验的沉淀，其中涉及某些关键特征对模型有很强的借鉴意义    选择切入点，原则：  具有业务意义（KPI指标、或转">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://erickycsu.github.io/checklist.github.io/2021/01/14/first-post/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="# 建模流程Check list明确建模目标数据探索 现状分析  了解各个环节的转化情况，目的有两个 &gt;  一方面可以找到转化薄弱的环节，做为建模的着手点；另一方面可以做为模型效果对标的baseline  当前在使用的方案是什么？效果如何？ &gt;  当前在使用的方案大多是业务经验的沉淀，其中涉及某些关键特征对模型有很强的借鉴意义    选择切入点，原则：  具有业务意义（KPI指标、或转">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-14T08:29:09.000Z">
<meta property="article:modified_time" content="2021-01-14T08:31:01.823Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://erickycsu.github.io/checklist.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-first-post" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/14/first-post/" class="article-date">
  <time class="dt-published" datetime="2021-01-14T08:29:09.000Z" itemprop="datePublished">2021-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="建模流程Check-list"><a href="#建模流程Check-list" class="headerlink" title="# 建模流程Check list"></a># 建模流程Check list</h2><h2 id="明确建模目标"><a href="#明确建模目标" class="headerlink" title="明确建模目标"></a>明确建模目标</h2><h3 id="数据探索"><a href="#数据探索" class="headerlink" title="数据探索"></a>数据探索</h3><ul>
<li><p>现状分析</p>
<ul>
<li><p>了解各个环节的转化情况，目的有两个 &gt;<br>  一方面可以找到转化薄弱的环节，做为建模的着手点；另一方面可以做为模型效果对标的baseline</p>
</li>
<li><p>当前在使用的方案是什么？效果如何？ &gt;<br>  当前在使用的方案大多是业务经验的沉淀，其中涉及某些关键特征对模型有很强的借鉴意义</p>
</li>
</ul>
</li>
<li><p>选择切入点，原则：</p>
<ul>
<li><p>具有业务意义（KPI指标、或转化较低的环节等） &gt;<br>  例：以识别客户资金需求为目标，首先对所能获取的数据有一个全面的了解后，可以使用招联新增借款，人行新增借款和联通新增借贷类app等数据作为判断资金需求的依据</p>
</li>
<li><p>有可靠数据支持 &gt;<br>  例1：无法获取客户浏览短信的数据，则不能将浏览与否作为打标依据，可考虑使用登录行为替代<br>  &gt;<br>  例2：当使用联通数据时，数据波动性较强，某时点之前的营销数据均会被删除，某时点之后的互联网标签数据口径不一致等，所以要求在建模前对可用数据进行验证，根据数据情况确定观察期与表现期，同时确保训练使用的数据在模型上线之后可以获取且口径一致</p>
</li>
</ul>
</li>
<li><p>问题建模</p>
<ul>
<li><p>将业务目标抽象为具体的问题</p>
<ul>
<li><p>  分类</p>
</li>
<li><p>  聚类</p>
</li>
<li><p>  回归等</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="SQL（数据粗加工）"><a href="#SQL（数据粗加工）" class="headerlink" title="SQL（数据粗加工）"></a>SQL（数据粗加工）</h2><h3 id="样本粗筛"><a href="#样本粗筛" class="headerlink" title="样本粗筛"></a>样本粗筛</h3><ul>
<li>根据业务目标确定目标客群，注意结果导向，保证识别出来的客群能够满足目标基本要求，防止模型测试时由于不可控因素导致效果下降<br>  &gt;<br>  例如：识别借款需求是为了新增借款，但新增借款的前提是能通过风控挡板，所以当前具有高风险特征（如高共债）的客户就不应该做为目标客群，具体场景的目标客群需与业务方沟通</li>
</ul>
<h3 id="特征粗筛"><a href="#特征粗筛" class="headerlink" title="特征粗筛"></a>特征粗筛</h3><ul>
<li>为避免数据量过大，需根据业务目标挑选相关分类的特征进行加工 &gt;<br>  例如：风险模型注重资信特征，营销模型注重相关历史行为</li>
</ul>
<h3 id="Code-check-list"><a href="#Code-check-list" class="headerlink" title="Code check list"></a>Code check list</h3><ul>
<li><p>  没有按照通用的格式对齐各字段，字段类型以及字段说明等</p>
</li>
<li><p>  没有在<code>case when</code>语句最后添加上<code>else null end</code>或者<code>else 0 end</code></p>
</li>
<li><p>  在impala查询语句中，不能在<code>left join</code>条件里面加上不等式，如：&gt;=，&lt;=等</p>
</li>
<li><p>  sql语句中存在大量不必要的<code>select distinct</code>语句</p>
</li>
<li><p>存在类似于<code>select *</code>，<code>select   count(*)</code>的语句，不符合规范，尽量只选取需要的列</p>
</li>
<li><p>注意少用子查询，可用<code>with subquerry as table   name</code>语法代替，提高并行度，对于反复使用的逻辑建立中间表提高代码复用率</p>
</li>
<li><p>  注意使用<strong>谓词下推</strong>提高运行效率，将过滤表达式尽可能移动至靠近数据源的位置，以使真正执行时能直接跳过无关的数据</p>
</li>
<li><p>  加工表时注意加上数据加工日期<code>etl_dt</code></p>
</li>
<li><p>  连接表时注意各个子表主键是否唯一</p>
</li>
<li><p>  能在sql做到的数据预处理（如：空缺值填补）尽量在sql中做</p>
</li>
</ul>
<h2 id="Python（数据细加工-amp-建模）"><a href="#Python（数据细加工-amp-建模）" class="headerlink" title="Python（数据细加工&amp;建模）"></a>Python（数据细加工&amp;建模）</h2><h3 id="样本选取"><a href="#样本选取" class="headerlink" title="样本选取"></a>样本选取</h3><ul>
<li><p>样本是否平衡？</p>
<ul>
<li><p>  若极不平衡(通常正负样本比例&lt;1/10)，则需进行样本平衡</p>
</li>
<li><p>  方法：过（欠）采样、人工合成样本、增加较少类别样本的权重、迁移学习等</p>
</li>
</ul>
</li>
<li><p>训练、验证和测试样本划分</p>
<ul>
<li><p>  训练：在部分样本中学习数据的概率分布</p>
</li>
<li><p>  验证：用训练数据之外的数据调整模型超参，平衡偏差和方差，提高模型泛化性能</p>
</li>
<li><p>测试：用训练及验证之外的数据对模型性能进行离线测试</p>
<blockquote>
<p>  <strong>注意</strong>：</p>
</blockquote>
<blockquote>
<p>  训练、验证和测试数据集尽量不要产生人与时间的交叉</p>
</blockquote>
<blockquote>
<p>  为避免由于人为数据集划分不均导致的测试效果不客观，可以使用交叉验证</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="特征加工与选择"><a href="#特征加工与选择" class="headerlink" title="特征加工与选择"></a>特征加工与选择</h3><ul>
<li><p>特征加工</p>
<ul>
<li><p>  数据类型转化</p>
</li>
<li><p>  空缺值&amp;异常值处理</p>
</li>
<li><p>  标准化、归一化（针对特定模型，如：广义线性模型）</p>
</li>
<li><p>  分桶</p>
</li>
<li><p>  特征交叉</p>
</li>
<li><p>  降维等</p>
</li>
</ul>
</li>
<li><p>特征选择</p>
<ul>
<li><p>  通过模型中集成的重要性指标选择，如：信息增益、分裂次数、覆盖度、权重等</p>
</li>
<li><p>  通过统计型指标，如：稳定性（PSI），信息量（IV）等</p>
</li>
<li><p>  通过相关性指标等</p>
</li>
</ul>
</li>
</ul>
<h3 id="重要变量响应度表现"><a href="#重要变量响应度表现" class="headerlink" title="重要变量响应度表现"></a>重要变量响应度表现</h3><ul>
<li><p>特征中能否挖掘出有效的专家规则？</p>
<ul>
<li><p>  若有则可以直接通过部署专家规则的形式解决问题，节省开发时间</p>
</li>
<li><p>方法：绘制分布图、相关性分析，计算IV值等</p>
<blockquote>
<p>  <strong>注意</strong>：此过程中需重点关注历史上与目标计算相关的变量（如模型目标是识别借贷需求，那么当前是否有贷有很大可能与目标强相关），若有强相关变量（IV&gt;1?视情况而定）则考虑是否分卡建模</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="模型训练-amp-评估"><a href="#模型训练-amp-评估" class="headerlink" title="模型训练&amp;评估"></a>模型训练&amp;评估</h3><ul>
<li><p>模型选择</p>
<ul>
<li><p>  广义线性模型</p>
</li>
<li><p>  树模型</p>
</li>
<li><p>  提升模型（boosting）</p>
</li>
<li><p>  集成模型（bagging）</p>
</li>
<li><p>  神经网络</p>
</li>
<li><p>  …</p>
</li>
</ul>
</li>
<li><p>效果评估</p>
<ul>
<li><p>混淆矩阵 | 标签 | 预测正样本 | 预测负样本 |<br>  |————|————|————| | 真实正样本 | TP | FN<br>  | | 真实负样本 | FP | TN |</p>
</li>
<li><p>  tpr = tp/(tp+fn)</p>
</li>
<li><p>  fpr = fp/(tn+fp)</p>
</li>
<li><p>  ks = max(tpr-fpr)</p>
</li>
<li><p>  accuracy = (tp+tn)/(tp+tn+fp+fn)</p>
</li>
<li><p>  precision = tp/(tp+fp)</p>
</li>
<li><p>  recall = tp/(tp+fn)</p>
</li>
<li><p>  lift = 分段响应率/总体响应率（营销关注）</p>
</li>
<li><p>  …</p>
</li>
</ul>
</li>
</ul>
<h3 id="效果-amp-效能提升"><a href="#效果-amp-效能提升" class="headerlink" title="效果&amp;效能提升"></a>效果&amp;效能提升</h3><ul>
<li><p>  模型选择：根据模型初步训练结果筛选效果好的模型</p>
</li>
<li><p>  模型融合：将多个模型结果进行融合</p>
</li>
<li><p>Refit：将验证与测试数据集用于训练 &gt;<br>  注意：模型融合中子模型最好分属于不同分类</p>
</li>
</ul>
<h3 id="Code-check-list-1"><a href="#Code-check-list-1" class="headerlink" title="Code check list"></a>Code check list</h3><ul>
<li><p>代码注释是否清晰，命名是否规范</p>
<ul>
<li><p>变量&amp;函数命名&amp;模块&amp;包命名:小写字母，单词之间用下划线分割，用简短的单词概括变量含义，如：<code>loan_amt,   get_loan_amt(), pandas.py</code></p>
</li>
<li><p>  类命名：单词首字母大写，如：<code>TreeNode</code></p>
</li>
</ul>
</li>
<li><p>  变量统一定义，是否存在硬编码现象</p>
</li>
<li><p>  重复的操作是否抽象成模块、类或函数</p>
</li>
<li><p>  循环操作是否可用矩阵操作替代，简单操作可直接通过numpy的矩阵运算实现，复杂操作可以使用pandas的apply函数</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># pandas 矩阵操作</span><br><span class="line">import pandas as pd</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">raw_data &#x3D; pd.read_csv(&#39;..&#x2F;input&#x2F;groceries-dataset&#x2F;Groceries_dataset.csv&#39;)</span><br><span class="line">print(&quot;数据量：&#123;&#125;&quot;.format(raw_data.shape))</span><br><span class="line">print(raw_data.head())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 定义函数</span><br><span class="line">def date_to_days(date_str, date_format&#x3D;&#39;%d-%m-%Y&#39;):</span><br><span class="line">    &#39;&#39;&#39;Convert date string to time type</span><br><span class="line">    </span><br><span class="line">    Args:</span><br><span class="line">        date_str: string, date</span><br><span class="line">        date_format: string, format of date(the first arguement)</span><br><span class="line">    </span><br><span class="line">    Returns:</span><br><span class="line">        time type of the date_str</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    </span><br><span class="line">    date &#x3D; datetime.strptime(date_str, date_format)</span><br><span class="line">    days &#x3D; (datetime.now() - date).days</span><br><span class="line">    return days</span><br><span class="line"></span><br><span class="line"># 测试1：循环运算</span><br><span class="line">start_tm1 &#x3D; time.time()</span><br><span class="line">print(&quot;测试1进行中……&quot;)</span><br><span class="line">test_df &#x3D; pd.DataFrame()</span><br><span class="line">for i in range(len(raw_data)):</span><br><span class="line">    test_df.loc[i, &#39;days&#39;] &#x3D; date_to_days(raw_data.loc[i, &#39;Date&#39;])</span><br><span class="line"></span><br><span class="line">end_tm1 &#x3D; time.time()</span><br><span class="line"></span><br><span class="line"># 测试2：矩阵运算</span><br><span class="line">start_tm2 &#x3D; time.time()</span><br><span class="line">print(&quot;测试2进行中……&quot;)</span><br><span class="line">test_df &#x3D; pd.DataFrame()</span><br><span class="line">test_df[&#39;days&#39;]  &#x3D; raw_data[&#39;Date&#39;].apply(date_to_days)</span><br><span class="line">test_df.head()</span><br><span class="line">end_tm2 &#x3D; time.time()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 测试结果</span><br><span class="line">test1_cost, test2_cost &#x3D; end_tm1 - start_tm1, end_tm2 - start_tm2</span><br><span class="line">print(&quot;测试1用时是测试2的&#123;:.2f&#125;倍&quot;.format(test1_cost&#x2F;test2_cost))</span><br></pre></td></tr></table></figure>
<h2 id="线上效果验证"><a href="#线上效果验证" class="headerlink" title="线上效果验证"></a>线上效果验证</h2><p>在模型开发完成后需先进行线上效果测试，测试效果满足上线要求后再进行部署，一般的效果验证流程如下：</p>
<ul>
<li><p>Step1.<br>  咨询业务同事近期的活动计划，挑选与模型目标相吻合的活动，主要获取两部分信息：<strong>客群</strong>和<strong>评价指标</strong><br>  &gt;<br>  例如：运营同事近期要对注册未授信客群进行营销打捞，目的为提升填写响应率（营销后来填写申请人数/触达人数）</p>
</li>
<li><p>Step2.<br>  结合活动计划设计模型测试方案，以<strong>控制变量法</strong>为原则，围绕模型的功能点对客群进行分组对比验证<br>  &gt; 例如：打捞模型具有预测填写响应分和推荐营销短信话术两个功能点， &gt; *<br>  为了验证响应分的排序性，根据模型分数将总客群分为高分客群、中分客群和低分客群3组，采用相同的话术进行营销，观察响应情况<br>  &gt; *<br>  为了验证推荐话术的准确性，将相同分数段的客户分为两组，分别采用模型推荐话术以及专家规则选定的话术进行触达，观察响应情况</p>
</li>
<li><p>Step3. 对各组客群执行相应策略，待表现期满计算Step1中的评价指标衡量模型效果<br>  &gt;<br>  不同业务衡量模型效果的方法略有不同，达标的标准也有差异，具体需与业务人员商定<br>  &gt;<br>  例如：营销场景主要使用<code>lift</code>作为衡量模型效果的指标，在打捞场景下若行动组高分客群（<strong>约前20%**）的填写响应率/整体填写响应率</strong>&gt;2.5**,或者在人数相当的条件下，高分行动组模型响应率/对照组专家规则响应率<strong>&gt;1.3</strong>，则认定模型效果较为显著，可以部署上线</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1、<strong>培养主动学习的习惯</strong>，建模过程涉及内容较多，此文档是一个大纲，受限于能力与篇幅难以面面俱到，其中的很多点都需要自主学习并学以致用；<br>2、<strong>培养业务思维</strong>，模型要解决的问题是从业务中抽象而来的，所以在建模过程中遇到的问题首先思考能否从业务角度解决，比如样本不平衡时看看目标定义是否合理，空缺值能否回刷等。同时模型的目标是解决业务问题，业务目标决定了模型的大方向，比如：风险类模型主要关注客户本身的属性，包括还款能力与还款意愿，目的是拦截坏客户，让损失最小化，所以加工特征时主要关注人的特征，而营销类模型大多是要通过策略与人的匹配来提升各环节的转化，目的是让收入最大化，所以在加工特征时不光要考虑人的属性，还要考虑人与策略的结合。<br>3、<strong>规范与流程只能决定模型的下限，思考与创新才能决定模型的上限</strong></p>
<h3 id="欢迎补充"><a href="#欢迎补充" class="headerlink" title="欢迎补充~"></a>欢迎补充~</h3><p>标签（空格分隔）： 数据加工 数据挖掘 注意事项</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://erickycsu.github.io/checklist.github.io/2021/01/14/first-post/" data-id="ckjwnj19s0000lgtxgdp808v2" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/14/first-post/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>